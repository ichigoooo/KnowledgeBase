## 模块二：选择与配置你的第一台火山引擎云服务器 (成本与弹性优先)

现在我们已经对后端服务和火山引擎有了初步了解，接下来将进入实践环节：选择和配置你的第一台云服务器。作为个人开发者，我们会特别关注成本效益和未来的弹性扩展能力。

### 1. 服务器选型核心要素

在火山引擎控制台创建云服务器实例时，你需要做出以下关键选择：

*   **地域 (Region) 与可用区 (Availability Zone)**：
    *   **地域**：指云服务器所在的物理数据中心的地理位置，例如华北（北京）、华东（上海）等。
        *   **选择原则**：
            *   **靠近用户**：选择离你的主要用户群体最近的地域，可以显著降低网络延迟，提升 App 的访问速度。
            *   **成本**：不同地域的资源价格可能会有差异。
            *   **法规要求**：某些行业或地区对数据存储位置有特定要求。
    *   **可用区**：是同一地域内，电力和网络相互独立的物理区域。一个地域通常包含多个可用区。
        *   **选择原则**：
            *   **高可用性**：将应用部署在同一地域的不同可用区，可以避免单点故障（例如，一个可用区发生故障，其他可用区的服务不受影响）。对于单台服务器的个人开发者初期，可以选择任意一个可用区。当后续考虑高可用部署时（例如使用负载均衡部署多台服务器），则需要将实例分布在不同可用区。
            *   **内网延迟**：同一可用区内的实例之间内网延迟最低。

*   **实例规格 (Instance Type)**：
    *   **概念**：实例规格定义了云服务器的 CPU、内存、网络性能等配置。火山引擎提供多种系列的实例规格，如通用型、计算型、内存型等，以适应不同的应用场景。
    *   **高性价比选择 (个人开发者)**：
        *   **CPU 与内存**：对于初期的移动应用后端（特别是基于 FastAPI 这种轻量级框架），通常不需要非常高的配置。可以从 **1核 CPU / 2GB 内存** 或 **2核 CPU / 4GB 内存** 的通用型实例开始。火山引擎通常会提供不同代次的 CPU，选择较新的代次通常性价比更高。
        *   **满足初期需求并考虑后续弹性升级**：选择一个能满足当前几个月预估负载的配置。火山引擎支持实例配置的升降级，如果后续发现配置不足或过剩，可以灵活调整。
    *   **参考文档**：仔细阅读火山引擎关于实例规格的文档，了解不同规格族的特性和适用场景。

*   **操作系统 (Operating System)**：
    *   **概念**：选择服务器运行的操作系统。
    *   **Linux 发行版**：对于 Python/FastAPI 后端，Linux 是最常见的选择。
        *   **Ubuntu**：用户基数大，社区活跃，软件源丰富，对新手友好。
        *   **CentOS** (现在有其衍生版如 Rocky Linux, AlmaLinux)：以稳定性著称，在企业级应用中广泛使用。
        *   **推荐**：对于个人开发者，**Ubuntu Server 最新 LTS (长期支持) 版本** 通常是一个不错的选择，因为它更新及时，社区支持好，并且有大量的教程和资源。选择轻量级意味着系统本身占用的资源较少。
    *   **Windows Server**：如果你的应用依赖 .NET 或其他 Windows 特定技术，则选择 Windows Server。

*   **存储 (Storage)**：
    *   **系统盘**：通常选择 40GB 到 100GB 的 SSD 云盘。SSD 的读写性能远高于 HDD，对应用响应速度有显著提升。
    *   **数据盘 (可选)**：如果预计会有大量的用户数据（如图片、文件、数据库文件）需要存储，建议单独购买数据盘。
        *   **类型**：同样推荐 SSD 云盘 (如高效云盘或SSD云盘) 以获得更好的性能，尤其是对于数据库。
        *   **容量**：根据你的预估数据量选择。数据盘可以后续扩容。
        *   **好处**：数据盘可以独立于实例存在。即使你释放了实例，只要不删除数据盘，数据依然可以保留，并挂载到新的实例上。

*   **网络与带宽 (Network & Bandwidth)**：
    *   **私有网络 (VPC)**：创建实例时会自动或需要你选择一个 VPC。建议为你的项目规划一个独立的 VPC。
    *   **公网 IP**：你的后端服务需要被移动 App 通过互联网访问，因此必须分配一个公网 IP 地址。
    *   **带宽计费模式**：
        *   **按固定带宽计费**：你预先购买一定的带宽值（如 1Mbps, 2Mbps, 5Mbps...），费用固定。适合流量相对稳定的应用。
        *   **按量付费带宽 (按使用流量计费)**：根据实际产生的出网流量计费。适合流量波动较大或初期流量不确定的应用。
        *   **权衡 (个人开发者)**：
            *   **初期**：如果对流量没有准确预估，可以先选择 **1Mbps 或 2Mbps 的固定带宽**，成本可控。或者选择**按量付费**，但需要关注流量消耗，避免超支。
            *   **监控**：通过云监控观察实际带宽使用情况，如果经常跑满固定带宽，则需要考虑增加带宽或切换到按量付费并结合CDN等优化。

### 2. 安全组配置

安全组是保护你云服务器安全的重要屏障，它充当虚拟防火墙，控制进出服务器的网络流量。

*   **安全组的概念与作用**：
    *   每个实例都必须属于至少一个安全组。
    *   安全组是**有状态的**：如果你允许了一个入站请求，那么对应的出站响应会被自动允许，反之亦然。
    *   你可以在一个安全组中定义多条规则。

*   **如何配置入站与出站规则**：
    *   **入站规则 (Inbound Rules)**：控制哪些外部流量可以访问你的服务器。
        *   **原则**：遵循**最小权限原则**，只开放必要的端口。
        *   **常见必要端口 (对于 FastAPI + PostgreSQL 后端)**：
            *   **SSH (TCP 端口 22)**：用于你远程登录和管理 Linux 服务器。**强烈建议**将源 IP 地址限制为你的固定 IP 地址或你信任的 IP 地址段，而不是 `0.0.0.0/0` (允许所有 IP)。如果你的 IP 不固定，可以先设置为你的当前公网 IP，后续再调整。
            *   **HTTP (TCP 端口 80)**：如果你的 FastAPI 应用通过 HTTP 提供服务。源 IP 通常设置为 `0.0.0.0/0` 以允许所有用户访问。
            *   **HTTPS (TCP 端口 443)**：如果你的 FastAPI 应用通过 HTTPS (更安全) 提供服务。源 IP 通常设置为 `0.0.0.0/0`。
            *   **PostgreSQL (TCP 端口 5432)**：
                *   **如果 PostgreSQL 与 FastAPI 应用部署在同一台服务器上**，并且你只从服务器内部访问数据库（FastAPI 应用连接本地数据库），则**不需要**对公网开放 5432 端口。这是最安全的方式。
                *   **如果你需要在外部（例如你的本地开发机）直接连接云服务器上的 PostgreSQL** 进行管理或调试，那么你需要开放 5432 端口，并且源 IP **强烈建议**设置为你的固定 IP 地址。**切勿将 PostgreSQL 端口对 `0.0.0.0/0` 开放，这非常危险。**
                *   如果使用火山引擎的 RDS for PostgreSQL 服务，则在其自身的安全设置中配置访问规则。
            *   **Uvicorn/Gunicorn (例如 TCP 端口 8000)**：FastAPI 开发时 Uvicorn 默认运行在 8000 端口。在生产环境中，通常会用 Nginx 等 Web 服务器反向代理到这个端口。如果直接对外暴露 Uvicorn/Gunicorn（不推荐用于生产），则需要开放此端口。
        *   **配置项**：
            *   **协议类型**：TCP, UDP, ICMP 等。
            *   **端口范围**：单个端口（如 80）或端口段（如 8000/8010）。
            *   **源地址 (Source)**：允许访问的 IP 地址或地址段（CIDR格式，如 `192.168.1.100/32` 表示单个 IP，`0.0.0.0/0` 表示所有 IP）。
            *   **策略**：允许 (Allow) 或拒绝 (Deny) – 通常我们只配置允许规则。
    *   **出站规则 (Outbound Rules)**：控制你的服务器可以访问哪些外部地址和端口。
        *   **默认通常是允许所有出站流量 (`0.0.0.0/0` 允许所有协议和端口)**。对于大多数应用场景，这个默认设置是可行的，因为服务器通常需要访问外部资源（如软件更新源、第三方 API 等）。
        *   如果需要更严格的安全控制，也可以限制出站规则。

    你可以在创建实例时选择或创建安全组，也可以在实例创建后修改安全组规则。

### 3. 购买与管理云服务器实例

*   **通过火山引擎控制台购买云服务器的步骤**：
    1.  登录火山引擎控制台。
    2.  找到"云服务器 ECS"服务入口。
    3.  点击"创建实例"或类似按钮。
    4.  **选择计费方式**：包年包月或按量付费。
    5.  **选择地域和可用区**。
    6.  **选择实例规格** (CPU、内存)。
    7.  **选择镜像** (操作系统)。
    8.  **配置系统盘和数据盘** (如果需要)。
    9.  **配置网络**：选择 VPC、子网，配置带宽和公网 IP。
    10. **配置安全组**：选择现有安全组或新建安全组并配置规则。
    11. **设置登录凭证**：
        *   **密钥对**：**推荐方式**。更安全。你需要创建一个密钥对，下载私钥文件（`.pem` 文件）并妥善保管。登录时使用私钥进行身份验证。
        *   **自定义密码**：设置实例的登录密码。
    12. **设置实例名称、描述等可选配置**。
    13. **确认配置和费用，然后购买**。
    *   **关注优惠活动与试用资源**：在购买前，留意火山引擎是否有针对新用户或特定实例的优惠活动、代金券或免费试用套餐，这能帮你节省开支。

*   **连接到云服务器**：
    实例创建成功并运行后，你需要连接上去进行操作。
    *   **Linux 实例 (使用 SSH)**：
        *   **工具**：
            *   macOS / Linux：使用系统自带的 `ssh` 命令行工具。
            *   Windows：可以使用 PuTTY, Xshell, MobaXterm，或者 Windows 10/11 自带的 OpenSSH 客户端 (在 PowerShell 或命令提示符中使用 `ssh`)。
        *   **连接命令 (使用密钥对)**：
            ```bash
            ssh -i /path/to/your-private-key.pem username@your_server_public_ip
            ```
            *   `/path/to/your-private-key.pem`：你下载的私钥文件的路径。
            *   `username`：通常是 `root` (如果镜像允许 root 登录) 或镜像指定的默认用户 (如 Ubuntu 镜像可能是 `ubuntu`，CentOS 可能是 `centos`)。具体请查看火山引擎的镜像说明。
            *   `your_server_public_ip`：你实例的公网 IP 地址。
            *   **权限**：私钥文件需要设置正确的权限 (例如 `chmod 400 your-private-key.pem`)，否则 SSH 客户端可能会拒绝使用。
        *   **连接命令 (使用密码)**：
            ```bash
            ssh username@your_server_public_ip
            ```
            然后根据提示输入密码。
    *   **Windows 实例 (使用远程桌面连接 - RDP)**：
        *   使用 Windows 自带的"远程桌面连接"工具。
        *   输入实例的公网 IP 地址。
        *   使用你设置的管理员账户和密码登录。

*   **服务器基本管理**：
    在火山引擎控制台，你可以对你的实例进行多种管理操作：
    *   **查看实例列表和详情**：CPU、内存使用率，网络状态，磁盘信息等。
    *   **启动、停止、重启实例**。
    *   **重置密码** (如果忘记了密码)。
    *   **更换操作系统** (重装系统)。
    *   **调整配置** (升级或降低实例规格)。
    *   **制作自定义镜像**。
    *   **管理安全组规则**。
    *   **监控与告警**：查看实例的监控数据，设置告警规则。

---

[返回大纲](#outline)
